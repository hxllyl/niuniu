<div class="panel panel-default contentBox">

  <div class="panel-heading lineTitle">
    <h3 class="panel-title"><%= @post.new_record? ? '发布资源' : '编辑资源' %></h3>
  </div>
  <div class="panel-body">
    <%- if @post.new_record? %>
        <%= form_tag(user_my_posts_path, method: :post, multipart: true, class: "form-horizontal sourceForm") do %>
            <%= render 'form_detail' %>
        <% end %>
    <% else %>
        <%= form_tag(user_my_post_path(current_user, @post), method: :put, multipart: true, class: "form-horizontal sourceForm") do %>
            <%= render 'form_detail' %>
        <% end %>
    <% end %></div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        $('#post_photos').find('input[type="file"]').on('change', function(){
          var n = $(this).attr('class').split(" ")[1];
          if(this.files && this.files[0]){
            var reader = new FileReader();
            reader.onload = function(e){
              $('#'+n).html('<div class="img" id='+n+'><span class="alt"></span><img src="'+e.target.result+'" width="140" height="94"></div>')
            };
            reader.readAsDataURL(this.files[0]);
          }
        });
    });

    function clearNoNum(obj) {
        obj.value = obj.value.replace(/[^\d.]/g, ""); //先把非数字的都替换掉，除了数字和.
        obj.value = obj.value.replace(/^\./g, ""); //必须保证第一个为数字而不是.
        obj.value = obj.value.replace(/\.{2,}/g, "."); //保证只有出现一个.而没有多个.
        obj.value = obj.value.replace(".", "$#$").replace(/\./g, "").replace("$#$", "."); //保证.只出现一次，而不能出现两次以上
        obj.value = obj.value.replace(/^(\-)*(\d+)\.(\d\d).*$/, "$1$2.$3"); //只能输入两个小数
    }
</script>
